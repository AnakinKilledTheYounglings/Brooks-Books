{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Card,CardContent,CardMedia,IconButton,Typography,Box,TextField,Collapse}from'@mui/material';import{Favorite,FavoriteBorder,ChatBubbleOutline,Send}from'@mui/icons-material';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function DrawingCard(_ref){var _drawing$likes,_drawing$likes2;let{drawing,bookId,onLikeUpdate}=_ref;const userId=localStorage.getItem('userId');const[isLiked,setIsLiked]=useState((_drawing$likes=drawing.likes)===null||_drawing$likes===void 0?void 0:_drawing$likes.includes(userId));const[likeCount,setLikeCount]=useState(((_drawing$likes2=drawing.likes)===null||_drawing$likes2===void 0?void 0:_drawing$likes2.length)||0);const[showComments,setShowComments]=useState(false);const[newComment,setNewComment]=useState('');const[comments,setComments]=useState(drawing.comments||[]);useEffect(()=>{var _drawing$likes3,_drawing$likes4;setIsLiked((_drawing$likes3=drawing.likes)===null||_drawing$likes3===void 0?void 0:_drawing$likes3.includes(userId));setLikeCount(((_drawing$likes4=drawing.likes)===null||_drawing$likes4===void 0?void 0:_drawing$likes4.length)||0);setComments(drawing.comments||[]);},[drawing,userId]);const handleLike=async()=>{try{console.log('Current userId:',userId);console.log('Current likes:',drawing.likes);console.log('Is currently liked:',isLiked);const endpoint=isLiked?'unlike':'like';const response=await fetch(`http://localhost:3001/api/books/${bookId}/drawings/${drawing._id}/${endpoint}`,{method:'POST',headers:{'Authorization':`Bearer ${localStorage.getItem('token')}`}});if(response.ok){// Update local state immediately\nsetIsLiked(!isLiked);setLikeCount(prev=>isLiked?prev-1:prev+1);// Call parent update\nonLikeUpdate();console.log('Like state updated:',{isLiked:!isLiked,newLikeCount:isLiked?likeCount-1:likeCount+1});}}catch(error){console.error('Error handling like:',error);}};const handleComment=async e=>{e.preventDefault();if(!newComment.trim())return;try{const response=await fetch(`http://localhost:3001/api/books/${bookId}/drawings/${drawing._id}/comments`,{method:'POST',headers:{'Authorization':`Bearer ${localStorage.getItem('token')}`,'Content-Type':'application/json'},body:JSON.stringify({content:newComment})});if(response.ok){const result=await response.json();// Update local comments state\nsetComments(prevComments=>[...prevComments,result.comment]);setNewComment('');// Call parent update\nonLikeUpdate();}}catch(error){console.error('Error posting comment:',error);}};return/*#__PURE__*/_jsxs(Card,{sx:{mb:2},children:[/*#__PURE__*/_jsx(CardMedia,{component:\"img\",image:drawing.imageUrl,alt:\"User Drawing\",sx:{height:'auto',maxHeight:'400px',objectFit:'contain'}}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:2},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:handleLike,color:isLiked?\"error\":\"default\",children:isLiked?/*#__PURE__*/_jsx(Favorite,{}):/*#__PURE__*/_jsx(FavoriteBorder,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:likeCount})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>setShowComments(!showComments),children:/*#__PURE__*/_jsx(ChatBubbleOutline,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:comments.length})]})]}),/*#__PURE__*/_jsx(Collapse,{in:showComments,children:/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[comments.map((comment,index)=>/*#__PURE__*/_jsxs(Box,{sx:{mb:1,p:1,bgcolor:'grey.100',borderRadius:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"primary\",children:comment.username}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:comment.content})]},index)),/*#__PURE__*/_jsxs(Box,{component:\"form\",onSubmit:handleComment,sx:{mt:2,display:'flex',gap:1},children:[/*#__PURE__*/_jsx(TextField,{size:\"small\",placeholder:\"Add a comment...\",value:newComment,onChange:e=>setNewComment(e.target.value),fullWidth:true,multiline:true,maxRows:3}),/*#__PURE__*/_jsx(IconButton,{type:\"submit\",color:\"primary\",disabled:!newComment.trim(),children:/*#__PURE__*/_jsx(Send,{})})]})]})})]})]});}export default DrawingCard;","map":{"version":3,"names":["React","useState","useEffect","Card","CardContent","CardMedia","IconButton","Typography","Box","TextField","Collapse","Favorite","FavoriteBorder","ChatBubbleOutline","Send","jsx","_jsx","jsxs","_jsxs","DrawingCard","_ref","_drawing$likes","_drawing$likes2","drawing","bookId","onLikeUpdate","userId","localStorage","getItem","isLiked","setIsLiked","likes","includes","likeCount","setLikeCount","length","showComments","setShowComments","newComment","setNewComment","comments","setComments","_drawing$likes3","_drawing$likes4","handleLike","console","log","endpoint","response","fetch","_id","method","headers","ok","prev","newLikeCount","error","handleComment","e","preventDefault","trim","body","JSON","stringify","content","result","json","prevComments","comment","sx","mb","children","component","image","imageUrl","alt","height","maxHeight","objectFit","display","alignItems","gap","size","onClick","color","variant","in","mt","map","index","p","bgcolor","borderRadius","username","onSubmit","placeholder","value","onChange","target","fullWidth","multiline","maxRows","type","disabled"],"sources":["/Users/BrooksCole/Documents/reading-community/frontend/src/components/DrawingCard.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { \n  Card, \n  CardContent, \n  CardMedia, \n  IconButton, \n  Typography, \n  Box,\n  TextField,\n  Collapse\n} from '@mui/material';\nimport { \n  Favorite, \n  FavoriteBorder, \n  ChatBubbleOutline,\n  Send\n} from '@mui/icons-material';\n\nfunction DrawingCard({ drawing, bookId, onLikeUpdate }) {\n  const userId = localStorage.getItem('userId');\n  const [isLiked, setIsLiked] = useState(drawing.likes?.includes(userId));\n  const [likeCount, setLikeCount] = useState(drawing.likes?.length || 0);\n  const [showComments, setShowComments] = useState(false);\n  const [newComment, setNewComment] = useState('');\n  const [comments, setComments] = useState(drawing.comments || []);\n\n  useEffect(() => {\n    setIsLiked(drawing.likes?.includes(userId));\n    setLikeCount(drawing.likes?.length || 0);\n    setComments(drawing.comments || []);\n  }, [drawing, userId]);\n\n  const handleLike = async () => {\n    try {\n      console.log('Current userId:', userId);\n      console.log('Current likes:', drawing.likes);\n      console.log('Is currently liked:', isLiked);\n\n      const endpoint = isLiked ? 'unlike' : 'like';\n      const response = await fetch(\n        `http://localhost:3001/api/books/${bookId}/drawings/${drawing._id}/${endpoint}`,\n        {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('token')}`\n          }\n        }\n      );\n\n      if (response.ok) {\n        // Update local state immediately\n        setIsLiked(!isLiked);\n        setLikeCount(prev => isLiked ? prev - 1 : prev + 1);\n        \n        // Call parent update\n        onLikeUpdate();\n        \n        console.log('Like state updated:', {\n          isLiked: !isLiked,\n          newLikeCount: isLiked ? likeCount - 1 : likeCount + 1\n        });\n      }\n    } catch (error) {\n      console.error('Error handling like:', error);\n    }\n  };\n\n  const handleComment = async (e) => {\n    e.preventDefault();\n    if (!newComment.trim()) return;\n\n    try {\n      const response = await fetch(\n        `http://localhost:3001/api/books/${bookId}/drawings/${drawing._id}/comments`,\n        {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${localStorage.getItem('token')}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({ content: newComment })\n        }\n      );\n\n      if (response.ok) {\n        const result = await response.json();\n        // Update local comments state\n        setComments(prevComments => [...prevComments, result.comment]);\n        setNewComment('');\n        // Call parent update\n        onLikeUpdate();\n      }\n    } catch (error) {\n      console.error('Error posting comment:', error);\n    }\n  };\n\n  return (\n    <Card sx={{ mb: 2 }}>\n      <CardMedia\n        component=\"img\"\n        image={drawing.imageUrl}\n        alt=\"User Drawing\"\n        sx={{ height: 'auto', maxHeight: '400px', objectFit: 'contain' }}\n      />\n      <CardContent>\n        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\n          <Box sx={{ display: 'flex', alignItems: 'center' }}>\n            <IconButton \n              size=\"small\" \n              onClick={handleLike}\n              color={isLiked ? \"error\" : \"default\"}\n            >\n              {isLiked ? <Favorite /> : <FavoriteBorder />}\n            </IconButton>\n            <Typography variant=\"body2\">\n              {likeCount}\n            </Typography>\n          </Box>\n          <Box sx={{ display: 'flex', alignItems: 'center' }}>\n            <IconButton \n              size=\"small\" \n              onClick={() => setShowComments(!showComments)}\n            >\n              <ChatBubbleOutline />\n            </IconButton>\n            <Typography variant=\"body2\">\n              {comments.length}\n            </Typography>\n          </Box>\n        </Box>\n\n        <Collapse in={showComments}>\n          <Box sx={{ mt: 2 }}>\n            {/* Comments list */}\n            {comments.map((comment, index) => (\n              <Box key={index} sx={{ mb: 1, p: 1, bgcolor: 'grey.100', borderRadius: 1 }}>\n                <Typography variant=\"subtitle2\" color=\"primary\">\n                  {comment.username}\n                </Typography>\n                <Typography variant=\"body2\">\n                  {comment.content}\n                </Typography>\n              </Box>\n            ))}\n\n            {/* Comment form */}\n            <Box \n              component=\"form\" \n              onSubmit={handleComment}\n              sx={{ \n                mt: 2, \n                display: 'flex', \n                gap: 1 \n              }}\n            >\n              <TextField\n                size=\"small\"\n                placeholder=\"Add a comment...\"\n                value={newComment}\n                onChange={(e) => setNewComment(e.target.value)}\n                fullWidth\n                multiline\n                maxRows={3}\n              />\n              <IconButton \n                type=\"submit\" \n                color=\"primary\"\n                disabled={!newComment.trim()}\n              >\n                <Send />\n              </IconButton>\n            </Box>\n          </Box>\n        </Collapse>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default DrawingCard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}