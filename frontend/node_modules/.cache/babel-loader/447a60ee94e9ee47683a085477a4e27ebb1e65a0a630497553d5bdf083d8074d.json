{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Card,CardContent,CardMedia,IconButton,Typography,Box,TextField,Collapse}from'@mui/material';import{Favorite,FavoriteBorder,ChatBubbleOutline,Send}from'@mui/icons-material';import apiService from'../services/apiService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function DrawingCard(_ref){var _drawing$likes,_drawing$likes2;let{drawing,bookId,onLikeUpdate}=_ref;const userId=localStorage.getItem('userId');const[isLiked,setIsLiked]=useState((_drawing$likes=drawing.likes)===null||_drawing$likes===void 0?void 0:_drawing$likes.includes(userId));const[likeCount,setLikeCount]=useState(((_drawing$likes2=drawing.likes)===null||_drawing$likes2===void 0?void 0:_drawing$likes2.length)||0);const[showComments,setShowComments]=useState(false);const[newComment,setNewComment]=useState('');const[comments,setComments]=useState(drawing.comments||[]);useEffect(()=>{var _drawing$likes3,_drawing$likes4;setIsLiked((_drawing$likes3=drawing.likes)===null||_drawing$likes3===void 0?void 0:_drawing$likes3.includes(userId));setLikeCount(((_drawing$likes4=drawing.likes)===null||_drawing$likes4===void 0?void 0:_drawing$likes4.length)||0);setComments(drawing.comments||[]);},[drawing,userId]);const handleLike=async()=>{try{console.log('Current userId:',userId);console.log('Current likes:',drawing.likes);console.log('Is currently liked:',isLiked);if(isLiked){await apiService.unlikeDrawing(bookId,drawing._id);}else{await apiService.likeDrawing(bookId,drawing._id);}// Update local state immediately\nsetIsLiked(!isLiked);setLikeCount(prev=>isLiked?prev-1:prev+1);// Call parent update\nonLikeUpdate();console.log('Like state updated:',{isLiked:!isLiked,newLikeCount:isLiked?likeCount-1:likeCount+1});}catch(error){console.error('Error handling like:',error);}};const handleComment=async e=>{e.preventDefault();if(!newComment.trim())return;try{const result=await apiService.addComment(bookId,drawing._id,newComment);// Update local comments state\nsetComments(prevComments=>[...prevComments,result.comment]);setNewComment('');// Call parent update\nonLikeUpdate();}catch(error){console.error('Error posting comment:',error);}};return/*#__PURE__*/_jsxs(Card,{sx:{mb:2},children:[/*#__PURE__*/_jsx(CardMedia,{component:\"img\",image:drawing.imageUrl,alt:\"User Drawing\",sx:{height:'auto',maxHeight:'400px',objectFit:'contain'}}),/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:2},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:handleLike,color:isLiked?\"error\":\"default\",children:isLiked?/*#__PURE__*/_jsx(Favorite,{}):/*#__PURE__*/_jsx(FavoriteBorder,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:likeCount})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>setShowComments(!showComments),children:/*#__PURE__*/_jsx(ChatBubbleOutline,{})}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:comments.length})]})]}),/*#__PURE__*/_jsx(Collapse,{in:showComments,children:/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[comments.map((comment,index)=>/*#__PURE__*/_jsxs(Box,{sx:{mb:1,p:1,bgcolor:'grey.100',borderRadius:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",color:\"primary\",children:comment.username}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:comment.content})]},index)),/*#__PURE__*/_jsxs(Box,{component:\"form\",onSubmit:handleComment,sx:{mt:2,display:'flex',gap:1},children:[/*#__PURE__*/_jsx(TextField,{size:\"small\",placeholder:\"Add a comment...\",value:newComment,onChange:e=>setNewComment(e.target.value),fullWidth:true,multiline:true,maxRows:3}),/*#__PURE__*/_jsx(IconButton,{type:\"submit\",color:\"primary\",disabled:!newComment.trim(),children:/*#__PURE__*/_jsx(Send,{})})]})]})})]})]});}export default DrawingCard;","map":{"version":3,"names":["React","useState","useEffect","Card","CardContent","CardMedia","IconButton","Typography","Box","TextField","Collapse","Favorite","FavoriteBorder","ChatBubbleOutline","Send","apiService","jsx","_jsx","jsxs","_jsxs","DrawingCard","_ref","_drawing$likes","_drawing$likes2","drawing","bookId","onLikeUpdate","userId","localStorage","getItem","isLiked","setIsLiked","likes","includes","likeCount","setLikeCount","length","showComments","setShowComments","newComment","setNewComment","comments","setComments","_drawing$likes3","_drawing$likes4","handleLike","console","log","unlikeDrawing","_id","likeDrawing","prev","newLikeCount","error","handleComment","e","preventDefault","trim","result","addComment","prevComments","comment","sx","mb","children","component","image","imageUrl","alt","height","maxHeight","objectFit","display","alignItems","gap","size","onClick","color","variant","in","mt","map","index","p","bgcolor","borderRadius","username","content","onSubmit","placeholder","value","onChange","target","fullWidth","multiline","maxRows","type","disabled"],"sources":["/Users/BrooksCole/Documents/reading-community/frontend/src/components/DrawingCard.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { \n  Card, \n  CardContent, \n  CardMedia, \n  IconButton, \n  Typography, \n  Box,\n  TextField,\n  Collapse\n} from '@mui/material';\nimport { \n  Favorite, \n  FavoriteBorder, \n  ChatBubbleOutline,\n  Send\n} from '@mui/icons-material';\nimport apiService from '../services/apiService';\n\nfunction DrawingCard({ drawing, bookId, onLikeUpdate }) {\n  const userId = localStorage.getItem('userId');\n  const [isLiked, setIsLiked] = useState(drawing.likes?.includes(userId));\n  const [likeCount, setLikeCount] = useState(drawing.likes?.length || 0);\n  const [showComments, setShowComments] = useState(false);\n  const [newComment, setNewComment] = useState('');\n  const [comments, setComments] = useState(drawing.comments || []);\n\n  useEffect(() => {\n    setIsLiked(drawing.likes?.includes(userId));\n    setLikeCount(drawing.likes?.length || 0);\n    setComments(drawing.comments || []);\n  }, [drawing, userId]);\n\n  const handleLike = async () => {\n    try {\n      console.log('Current userId:', userId);\n      console.log('Current likes:', drawing.likes);\n      console.log('Is currently liked:', isLiked);\n  \n      if (isLiked) {\n        await apiService.unlikeDrawing(bookId, drawing._id);\n      } else {\n        await apiService.likeDrawing(bookId, drawing._id);\n      }\n  \n      // Update local state immediately\n      setIsLiked(!isLiked);\n      setLikeCount(prev => isLiked ? prev - 1 : prev + 1);\n      \n      // Call parent update\n      onLikeUpdate();\n      \n      console.log('Like state updated:', {\n        isLiked: !isLiked,\n        newLikeCount: isLiked ? likeCount - 1 : likeCount + 1\n      });\n    } catch (error) {\n      console.error('Error handling like:', error);\n    }\n  };\n\n  const handleComment = async (e) => {\n    e.preventDefault();\n    if (!newComment.trim()) return;\n  \n    try {\n      const result = await apiService.addComment(bookId, drawing._id, newComment);\n      \n      // Update local comments state\n      setComments(prevComments => [...prevComments, result.comment]);\n      setNewComment('');\n      // Call parent update\n      onLikeUpdate();\n    } catch (error) {\n      console.error('Error posting comment:', error);\n    }\n  };\n\n  return (\n    <Card sx={{ mb: 2 }}>\n      <CardMedia\n        component=\"img\"\n        image={drawing.imageUrl}\n        alt=\"User Drawing\"\n        sx={{ height: 'auto', maxHeight: '400px', objectFit: 'contain' }}\n      />\n      <CardContent>\n        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\n          <Box sx={{ display: 'flex', alignItems: 'center' }}>\n            <IconButton \n              size=\"small\" \n              onClick={handleLike}\n              color={isLiked ? \"error\" : \"default\"}\n            >\n              {isLiked ? <Favorite /> : <FavoriteBorder />}\n            </IconButton>\n            <Typography variant=\"body2\">\n              {likeCount}\n            </Typography>\n          </Box>\n          <Box sx={{ display: 'flex', alignItems: 'center' }}>\n            <IconButton \n              size=\"small\" \n              onClick={() => setShowComments(!showComments)}\n            >\n              <ChatBubbleOutline />\n            </IconButton>\n            <Typography variant=\"body2\">\n              {comments.length}\n            </Typography>\n          </Box>\n        </Box>\n\n        <Collapse in={showComments}>\n          <Box sx={{ mt: 2 }}>\n            {/* Comments list */}\n            {comments.map((comment, index) => (\n              <Box key={index} sx={{ mb: 1, p: 1, bgcolor: 'grey.100', borderRadius: 1 }}>\n                <Typography variant=\"subtitle2\" color=\"primary\">\n                  {comment.username}\n                </Typography>\n                <Typography variant=\"body2\">\n                  {comment.content}\n                </Typography>\n              </Box>\n            ))}\n\n            {/* Comment form */}\n            <Box \n              component=\"form\" \n              onSubmit={handleComment}\n              sx={{ \n                mt: 2, \n                display: 'flex', \n                gap: 1 \n              }}\n            >\n              <TextField\n                size=\"small\"\n                placeholder=\"Add a comment...\"\n                value={newComment}\n                onChange={(e) => setNewComment(e.target.value)}\n                fullWidth\n                multiline\n                maxRows={3}\n              />\n              <IconButton \n                type=\"submit\" \n                color=\"primary\"\n                disabled={!newComment.trim()}\n              >\n                <Send />\n              </IconButton>\n            </Box>\n          </Box>\n        </Collapse>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default DrawingCard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}